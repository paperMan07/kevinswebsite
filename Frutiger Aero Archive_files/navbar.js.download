// Navbar Toggle
var MENU_BUTTON_TEXT = document.getElementById("hideNavbarButtonText");
var MENU_BUTTON = document.getElementById("navbarToggleButton");
var NAV_MENU = document.getElementById("navigationMenu");
var MAIN_CONTENT = document.getElementById("mainContent");

MENU_BUTTON.addEventListener("click", function () {
  if (NAV_MENU.style.display === "block") {
    MENU_BUTTON_TEXT.innerHTML = "Menu >";
    NAV_MENU.style.display = "none";
  } else {
    MENU_BUTTON_TEXT.innerHTML = "Hide >";
    NAV_MENU.style.display = "block";
  }
});

window.addEventListener("resize", function () {
  if (window.innerWidth > 750) {
    MENU_BUTTON_TEXT.innerHTML = "Hide >";
    NAV_MENU.style.display = "block";
  }

  if (window.innerWidth < 750) {
    MENU_BUTTON_TEXT.innerHTML = "Menu >";
    NAV_MENU.style.display = "none";
  }
});

// Global Sound Effects Toggle
var GLOBAL_SOUND_TOGGLE = document.getElementById("navSoundToggle");
var NAV_LINKS = document.getElementsByClassName("nav-inactive");

var enabled_sound = new Audio("/sounds/global_sound_on.wav");
var disabled_sound = new Audio("/sounds/global_sound_off.wav");

var global_sound = false;
try {
  global_sound = localStorage.getItem("globalSound") === "true";
} catch (e) {}

GLOBAL_SOUND_TOGGLE.innerHTML = global_sound ? "Sounds On" : "Sounds Off";

GLOBAL_SOUND_TOGGLE.addEventListener("click", function () {
  global_sound = !global_sound;
  try {
    localStorage.setItem("globalSound", global_sound);
  } catch (e) {}
  if (global_sound) {
    GLOBAL_SOUND_TOGGLE.innerHTML = "Sounds On";
    enabled_sound.play();
    disabled_sound.pause();
    disabled_sound.currentTime = 0;
  } else {
    GLOBAL_SOUND_TOGGLE.innerHTML = "Sounds Off";
    disabled_sound.play();
    enabled_sound.pause();
    enabled_sound.currentTime = 0;
  }
});

// Navbar hover sound
var nav_sound = new Audio("/sounds/navbar.wav");
var navLinks = NAV_MENU.getElementsByTagName("a");
for (var i = 0; i < navLinks.length; i++) {
  navLinks[i].addEventListener("mouseover", function () {
    if (global_sound) {
      try {
        nav_sound.currentTime = 0;
        nav_sound.play();
      } catch (e) {
        // IE doesn't support .catch()
      }
    }
  });
}

// Link hover sounds
var link_sound = new Audio("/sounds/links.wav");
var contentLinks = MAIN_CONTENT.getElementsByTagName("a");
for (var j = 0; j < contentLinks.length; j++) {
  contentLinks[j].addEventListener("mouseover", function () {
    if (global_sound && this.getElementsByTagName("img").length === 0) {
      try {
        link_sound.currentTime = 0;
        link_sound.play();
      } catch (e) {}
    }
  });
}

// Themes
var THEME_SWAPPER = document.getElementById("navThemeChanger");
var theme_sound = new Audio("/sounds/media_controls.wav");

var themes = [
  {},
  { url: "/css/themes/frutiger_aero.css" },
  { url: "/css/themes/nightcore.css" },
  { url: "/css/themes/y2k.css" },
  { url: "/css/themes/hatsune_miku.css" },
  { url: "/css/themes/kasane_teto.css" },
  { url: "/css/themes/k-on.css" },
];

var currentThemeIndex = 0;

(function () {
  var savedTheme = null;
  try {
    savedTheme = localStorage.getItem("theme");
  } catch (e) {}

  var themeIndex = parseInt(savedTheme, 10);

  // Validate themeIndex: must be a real number and within themes array
  if (!isNaN(themeIndex) && themeIndex >= 0 && themeIndex < themes.length) {
    if (themeIndex === 0) {
      removeOtherThemes();
    } else {
      applyTheme(themeIndex);
    }
    currentThemeIndex = themeIndex;
  } else {
    // fallback: make sure to remove any themes and set index to 0
    removeOtherThemes();
    currentThemeIndex = 0;
  }

  headerImages();
})();

function switchToNextTheme() {
  if (global_sound) {
    theme_sound.play();
  }

  currentThemeIndex = (currentThemeIndex + 1) % themes.length;

  if (currentThemeIndex === 0) {
    removeOtherThemes();
    headerImages();
  } else {
    applyTheme(currentThemeIndex);
  }

  try {
    localStorage.setItem("theme", currentThemeIndex);
  } catch (e) {}
}

function applyTheme(themeIndex) {
  var existingStyleSheet = document.querySelector(
    'link[rel="stylesheet"][data-theme]'
  );
  if (existingStyleSheet) {
    existingStyleSheet.parentNode.removeChild(existingStyleSheet);
  }

  var theme = document.createElement("link");
  theme.rel = "stylesheet";
  theme.type = "text/css";
  theme.href = themes[themeIndex].url;
  theme.setAttribute("data-theme", "theme-" + themeIndex);
  document.getElementsByTagName("head")[0].appendChild(theme);
  headerImages();
}

function removeOtherThemes() {
  var links = document.getElementsByTagName("link");
  for (var i = links.length - 1; i >= 0; i--) {
    if (
      links[i].getAttribute("data-theme") &&
      links[i].getAttribute("data-theme") !== "theme-0"
    ) {
      links[i].parentNode.removeChild(links[i]);
    }
  }
}

THEME_SWAPPER.addEventListener("click", switchToNextTheme);

// Header Image Swap
var INTRO_BANNER = document.getElementById("introBanner");
var WALLPAPERS_BANNER = document.getElementById("wallpapersBanner");
var RESOURCES_BANNER = document.getElementById("resourcesBanner");
var HISTORY_BANNER = document.getElementById("historyBanner");
var MUSIC_HEADER_IMG = document.getElementById("musicHeaderImage");
var ICONS_BANNER = document.getElementById("iconsBanner");
var SITE_MAP_BANNER = document.getElementById("sitemapBanner");
var SITE_INFO_BANNER = document.getElementById("siteInfoBanner");
var TELEVISIONS_BANNER = document.getElementById("televisionsBanner");
var AERO_WEBRING_BANNER = document.getElementById("aeroWebringBanner");
var INDIE_GAMES_BANNER = document.getElementById("indieGamesBanner");
var OTHER_LINKS_BANNER = document.getElementById("otherLinksBanner");
var CONTACT_BANNER = document.getElementById("contactBanner");

function headerImages() {
  var banners = [
    { element: INTRO_BANNER, file: "introduction_banner.jpg" },
    { element: WALLPAPERS_BANNER, file: "wallpapers_header.jpg" },
    { element: RESOURCES_BANNER, file: "resources_header.jpg" },
    { element: HISTORY_BANNER, file: "history_header.jpg" },
    { element: MUSIC_HEADER_IMG, file: "music_header.png" },
    { element: ICONS_BANNER, file: "icons_header.jpg" },
    { element: SITE_MAP_BANNER, file: "sitemap_header.jpg" },
    { element: SITE_INFO_BANNER, file: "site_info_header.jpg" },
    { element: TELEVISIONS_BANNER, file: "televisions_header.jpg" },
    { element: AERO_WEBRING_BANNER, file: "aero_webring_header.jpg" },
    { element: INDIE_GAMES_BANNER, file: "indie_games_header.jpg" },
    { element: OTHER_LINKS_BANNER, file: "other_links_header.jpg" },
    { element: CONTACT_BANNER, file: "contact_header.jpg" },
  ];

  var themeFolders = {
    2: "nightcore",
    3: "y2k",
    4: "miku",
    5: "teto",
    6: "k-on",
  };
  var themeFolder = themeFolders[currentThemeIndex];
  var basePath = themeFolder
    ? "/images/header_images/themes/" + themeFolder + "/"
    : "/images/header_images/";

  for (var i = 0; i < banners.length; i++) {
    if (banners[i].element) {
      banners[i].element.src = basePath + banners[i].file;
    }
  }
}

headerImages();

let copyButton = document.getElementById("copyButton");

// Copy Button Sound
if (copyButton) {
  copyButton.addEventListener("click", function () {
    if (global_sound) {
      theme_sound.play();
    }
  });
}

// Smooth Scrolling
document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
  anchor.addEventListener("click", function (e) {
    e.preventDefault();

    document.querySelector(this.getAttribute("href")).scrollIntoView({
      behavior: "smooth",
    });
  });
});
